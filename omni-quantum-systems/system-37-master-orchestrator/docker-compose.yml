x-logging:
  driver: json-file
  options:
    max-size: 50m
    max-file: '5'
    tag: '{{.Name}}'
x-labels:
  omni.quantum.system: '37'
  omni.quantum.component: master-orchestrator
  omni.quantum.tier: critical
networks:
  omni-quantum-network:
    external: true
volumes:
  orchestrator-data:
    name: omni-orchestrator-data
services:
  omni-orchestrator:
    build:
      context: ./config/orchestrator
      dockerfile: Dockerfile
    container_name: omni-orchestrator
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 50m
        max-file: '5'
        tag: '{{.Name}}'
    labels:
      omni.quantum.component: orchestrator
      omni.quantum.tier: business
      omni.quantum.critical: 'true'
    ports:
    - 19500:9500
    environment:
      ORCHESTRATOR_PORT: '9500'
      ORCHESTRATOR_HOST: 0.0.0.0
      LOG_LEVEL: INFO
      DATABASE_URL: postgresql://omni_orchestrator:${ORCHESTRATOR_DB_PASSWORD:-orchestrator_secret}@omni-postgres:5432/omni_orchestrator
      REDIS_URL: redis://omni-redis:6379/5
      BACKUP_URL: http://omni-restic-server:8000
      VAULT_URL: http://omni-vault:8200
      VAULT_TOKEN: ${VAULT_ROOT_TOKEN:-}
      LITELLM_URL: http://omni-litellm:4000
      AUTHENTIK_URL: http://omni-authentik:9000
      PROMETHEUS_URL: http://omni-prometheus:9090
      GRAFANA_URL: http://omni-grafana:3000
      LOKI_URL: http://omni-loki:3100
      GITEA_URL: http://omni-gitea:3000
      GITEA_TOKEN: ${GITEA_ADMIN_TOKEN:-}
      OLLAMA_URL: http://omni-ollama:11434
      N8N_URL: http://omni-n8n:5678
      MATTERMOST_URL: http://omni-mattermost:8065
      MATTERMOST_TOKEN: ${MATTERMOST_BOT_TOKEN:-}
      MATTERMOST_WEBHOOK: ${MATTERMOST_WEBHOOK_URL:-}
      QDRANT_URL: http://omni-qdrant:6333
      MINIO_URL: http://omni-minio:9000
      LANGFUSE_URL: http://omni-langfuse:3000
      PLANE_URL: https://notion.so
      NANGO_URL: http://omni-nango:3003
      OPENHANDS_URL: http://omni-openhands:3000
      SWEAGENT_URL: http://omni-swe-agent:8000
      COOLIFY_URL: http://omni-coolify:8000
      FLOWISE_URL: http://omni-flowise:3000
      WIKIJS_URL: https://notion.so
      SUPERSET_URL: http://omni-superset:8088
      CALCOM_URL: http://omni-calcom:3000
      TWENTY_URL: https://notion.so
      CRATER_URL: http://omni-crater:80
      CROWDSEC_URL: http://omni-crowdsec:8080
      PORTAINER_URL: http://omni-portainer:9000
      TOKEN_INFINITY_URL: http://omni-token-infinity:9600
      OMI_BRIDGE_URL: http://omni-omi-bridge:9700
      OMI_WEBHOOK: ${OMI_WEBHOOK_URL:-}
      THANOS_URL: http://omni-thanos-query:9091
      ANOMALY_DETECTOR_URL: http://omni-anomaly-detector:8181
      SLA_TRACKER_URL: http://omni-sla-tracker:8182
      CAPACITY_PLANNER_URL: http://omni-capacity-planner:8183
      LOG_PATTERN_DETECTOR_URL: http://omni-log-pattern-detector:8184
      LOG_CORRELATOR_URL: http://omni-log-correlator:8185
      UPTIME_KUMA_URL: http://omni-uptime-kuma:3001
      BACKUP_ORCHESTRATOR_URL: http://omni-backup-orchestrator:8187
      BACKUP_VERIFIER_URL: http://omni-backup-verifier:8188
      ROTATION_AGENT_URL: http://omni-secret-rotation-agent:8189
      TRAEFIK_URL: http://omni-traefik:8080
      WOODPECKER_URL: http://omni-woodpecker-server:8000
      CODER_URL: http://omni-coder:7080
    volumes:
    - orchestrator-data:/data
    - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - omni-quantum-network
    - omni-quantum-network
    healthcheck:
      test:
      - CMD
      - python
      - -c
      - import httpx; httpx.get('http://localhost:9500/health').raise_for_status()
      interval: 15s
      timeout: 5s
      retries: 5
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    security_opt:
    - no-new-privileges:true
    cap_drop:
    - ALL
  omni-dashboard:
    build:
      context: ./config/dashboard
      dockerfile: Dockerfile
    container_name: omni-dashboard
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 50m
        max-file: '5'
        tag: '{{.Name}}'
    labels:
      omni.quantum.component: dashboard
      omni.quantum.tier: business
      omni.quantum.critical: 'false'
    ports:
    - 19501:9501
    environment:
      ORCHESTRATOR_URL: http://omni-orchestrator:9500
      DASHBOARD_PORT: '9501'
    networks:
      - omni-quantum-network
    - omni-quantum-network
    depends_on:
      omni-orchestrator:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - curl -f http://localhost:9501/health || wget -qO- http://localhost:9501/health >/dev/null || nc -z localhost 9501
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    security_opt:
    - no-new-privileges:true
    cap_drop:
    - ALL
  omni-mattermost-bot:
    build:
      context: ./config/mattermost-bot
      dockerfile: Dockerfile
    container_name: omni-mattermost-bot
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 50m
        max-file: '5'
        tag: '{{.Name}}'
    labels:
      omni.quantum.component: mattermost-bot
      omni.quantum.tier: business
      omni.quantum.critical: 'false'
    environment:
      ORCHESTRATOR_URL: http://omni-orchestrator:9500
      MATTERMOST_URL: http://omni-mattermost:8065
      MATTERMOST_TOKEN: ${MATTERMOST_BOT_TOKEN:-}
      BOT_CHANNEL: omni-control
    networks:
      - omni-quantum-network
    - omni-quantum-network
    depends_on:
      omni-orchestrator:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - exit 0
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    security_opt:
    - no-new-privileges:true
    cap_drop:
    - ALL
  omni-voice-bridge:
    build:
      context: ./config/voice-bridge
      dockerfile: Dockerfile
    container_name: omni-voice-bridge
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 50m
        max-file: '5'
        tag: '{{.Name}}'
    labels:
      omni.quantum.component: voice-bridge
      omni.quantum.tier: business
      omni.quantum.critical: 'false'
    ports:
    - 19502:9502
    environment:
      ORCHESTRATOR_URL: http://omni-orchestrator:9500
      LITELLM_URL: http://omni-litellm:4000
      OMI_WEBHOOK: ${OMI_WEBHOOK_URL:-}
      VOICE_BRIDGE_PORT: '9502'
    networks:
      - omni-quantum-network
    - omni-quantum-network
    depends_on:
      omni-orchestrator:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - curl -f http://localhost:9502/health || wget -qO- http://localhost:9502/health >/dev/null || nc -z localhost 9502
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    security_opt:
    - no-new-privileges:true
    cap_drop:
    - ALL
  omni-event-processor:
    build:
      context: ./config/event-processor
      dockerfile: Dockerfile
    container_name: omni-event-processor
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 50m
        max-file: '5'
        tag: '{{.Name}}'
    labels:
      omni.quantum.component: event-processor
      omni.quantum.tier: business
      omni.quantum.critical: 'false'
    environment:
      REDIS_URL: redis://omni-redis:6379/11
      ORCHESTRATOR_URL: http://omni-orchestrator:9500
      MATTERMOST_WEBHOOK: ${MATTERMOST_WEBHOOK_URL:-}
      OMI_WEBHOOK: ${OMI_WEBHOOK_URL:-}
    networks:
      - omni-quantum-network
    - omni-quantum-network
    depends_on:
      omni-orchestrator:
        condition: service_healthy
    healthcheck:
      test:
      - CMD-SHELL
      - exit 0
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '1.0'
    security_opt:
    - no-new-privileges:true
    cap_drop:
    - ALL
