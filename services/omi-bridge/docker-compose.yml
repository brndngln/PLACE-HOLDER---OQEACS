version: "3.8"

services:
  omni-omi-bridge:
    build: .
    container_name: omni-omi-bridge
    restart: unless-stopped
    ports:
      - "9700:9700"
      - "9701:9701"
    environment:
      - LITELLM_URL=http://omni-litellm:4000
      - ORCHESTRATOR_URL=http://omni-orchestrator:9500
      - OMI_DEVICE_TOKEN=${OMI_DEVICE_TOKEN}
      - MATTERMOST_WEBHOOK_URL=${MATTERMOST_WEBHOOK_URL}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9700/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: "0.25"
    depends_on:
      omni-litellm:
        condition: service_healthy
      omni-orchestrator:
        condition: service_healthy
    networks:
      - omni-quantum-network
    labels:
      omni.quantum.component: "omi-bridge"
      omni.quantum.tier: "high"

networks:
  omni-quantum-network:
    external: true
